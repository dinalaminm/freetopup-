<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Add Money - FREE TOPUP PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="bg-[#f0f5ff]">

    <div id="app" v-cloak>
        <!-- Header -->
        <header class="bg-white shadow-sm border-b p-3 flex items-center sticky top-0 z-50">
            <a href="index.html" class="mr-3 text-gray-600"><i class="fa-solid fa-arrow-left text-lg"></i></a>
            <h1 class="font-bold text-lg text-gray-800">Add Money</h1>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-6 max-w-md pb-24">
            <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                <h2 class="font-bold text-gray-700 mb-4 text-center">Select Payment Method</h2>
                
                <!-- Method Selector -->
                <div class="grid grid-cols-3 gap-3 mb-6">
                    <div @click="form.method = 'bkash'" :class="form.method === 'bkash' ? 'border-pink-500 bg-pink-50 ring-1 ring-pink-500' : 'border-gray-200'" class="border p-2 rounded-lg flex flex-col items-center justify-center cursor-pointer transition">
                        <img src="https://seeklogo.com/images/B/bkash-logo-FBB258B90F-seeklogo.com.png" class="h-8 object-contain">
                        <span class="text-xs mt-1 font-bold">Bkash</span>
                    </div>
                    <div @click="form.method = 'nagad'" :class="form.method === 'nagad' ? 'border-orange-500 bg-orange-50 ring-1 ring-orange-500' : 'border-gray-200'" class="border p-2 rounded-lg flex flex-col items-center justify-center cursor-pointer transition">
                        <img src="https://seeklogo.com/images/N/nagad-logo-7A70CCFEE0-seeklogo.com.png" class="h-8 object-contain">
                        <span class="text-xs mt-1 font-bold">Nagad</span>
                    </div>
                    <div @click="form.method = 'rocket'" :class="form.method === 'rocket' ? 'border-purple-500 bg-purple-50 ring-1 ring-purple-500' : 'border-gray-200'" class="border p-2 rounded-lg flex flex-col items-center justify-center cursor-pointer transition">
                        <img src="https://seeklogo.com/images/D/dutch-bangla-rocket-logo-B4D1CC458D-seeklogo.com.png" class="h-8 object-contain">
                        <span class="text-xs mt-1 font-bold">Rocket</span>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="bg-blue-50 text-blue-800 p-3 rounded-lg text-xs mb-4 border border-blue-200">
                    <p class="font-bold"><i class="fa-solid fa-circle-info"></i> নির্দেশাবলী:</p>
                    <p class="mt-1">আমাদের {{ form.method.toUpperCase() }} নাম্বারে টাকা সেন্ড মানি করুন। এরপর নিচের ফর্মটি পূরণ করুন।</p>
                    <p class="font-bold mt-1 text-lg select-all">01700000000</p>
                </div>

                <!-- Form -->
                <label class="block text-sm font-bold text-gray-600 mb-2">Amount (টাকার পরিমাণ)</label>
                <input v-model="form.amount" type="number" placeholder="সর্বনিম্ন ৫০ টাকা" class="w-full border border-gray-300 p-3 rounded-lg mb-4 outline-none focus:border-purple-500 transition">

                <label class="block text-sm font-bold text-gray-600 mb-2">Sender Number (আপনার নাম্বার)</label>
                <input v-model="form.sender" type="tel" placeholder="01xxxxxxxxx" class="w-full border border-gray-300 p-3 rounded-lg mb-4 outline-none focus:border-purple-500 transition">

                <label class="block text-sm font-bold text-gray-600 mb-2">Transaction ID (TrxID)</label>
                <input v-model="form.trxId" type="text" placeholder="যেমন: 9HG76S..." class="w-full border border-gray-300 p-3 rounded-lg mb-6 outline-none focus:border-purple-500 transition uppercase">

                <button @click="submitDeposit" :disabled="loading" class="w-full bg-[#583cb3] text-white py-3 rounded-lg font-bold shadow-lg hover:bg-purple-700 transition flex justify-center items-center">
                    <span v-if="!loading">Verify Payment</span>
                    <i v-else class="fa-solid fa-circle-notch fa-spin"></i>
                </button>
            </div>
        </main>

        <!-- Bottom Nav -->
        <div class="fixed bottom-0 w-full bg-white border-t border-gray-200 z-50 pb-safe shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
            <div class="grid grid-cols-5 h-16 max-w-md mx-auto">
                <a href="index.html" class="nav-item"><i class="fa-solid fa-house"></i><span>Home</span></a>
                <a href="add-money.html" class="nav-item active"><i class="fa-solid fa-wallet"></i><span>Add Money</span></a>
                <a href="orders.html" class="nav-item"><i class="fa-solid fa-file-invoice"></i><span>My Orders</span></a>
                <a href="codes.html" class="nav-item"><i class="fa-solid fa-gift"></i><span>My Codes</span></a>
                <a href="account.html" class="nav-item"><i class="fa-solid fa-user"></i><span>Account</span></a>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { createApp, ref } from "https://unpkg.com/vue@3/dist/vue.esm-browser.js";

        const firebaseConfig = {
          apiKey: "AIzaSyACUK207BRvtR5yc1UhYLS9FlMitVVlrrE",
          authDomain: "freetopup-fd263.firebaseapp.com",
          projectId: "freetopup-fd263",
          storageBucket: "freetopup-fd263.firebasestorage.app",
          messagingSenderId: "756173302110",
          appId: "1:756173302110:web:14227664f6b5d14d9047cf"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        createApp({
            setup() {
                const loading = ref(false);
                const form = ref({
                    method: 'bkash',
                    amount: '',
                    sender: '',
                    trxId: ''
                });

                // User ID from LocalStorage (Simulated Login)
                let userId = localStorage.getItem('userId');
                if (!userId) {
                    userId = 'user_' + Math.floor(Math.random() * 100000);
                    localStorage.setItem('userId', userId);
                }

                const submitDeposit = async () => {
                    if (!form.value.amount || !form.value.sender || !form.value.trxId) {
                        alert("সবগুলো তথ্য সঠিকভাবে দিন!");
                        return;
                    }
                    if (form.value.amount < 50) {
                        alert("সর্বনিম্ন ৫০ টাকা ডিপোজিট করতে হবে।");
                        return;
                    }

                    loading.value = true;
                    try {
                        await addDoc(collection(db, "deposits"), {
                            userId: userId,
                            method: form.value.method,
                            amount: Number(form.value.amount),
                            senderNumber: form.value.sender,
                            trxId: form.value.trxId,
                            status: "pending", // admin verify korbe
                            createdAt: serverTimestamp()
                        });
                        alert("আপনার রিকোয়েস্ট সফল হয়েছে! কিছুক্ষণের মধ্যে ব্যালেন্স যোগ হবে।");
                        form.value.amount = '';
                        form.value.sender = '';
                        form.value.trxId = '';
                        window.location.href = 'account.html';
                    } catch (error) {
                        console.error("Error:", error);
                        alert("সমস্যা হয়েছে, আবার চেষ্টা করুন।");
                    } finally {
                        loading.value = false;
                    }
                };

                return { loading, form, submitDeposit };
            }
        }).mount('#app');
    </script>
</body>
</html>